@page
@model TravelGod.ru.Pages.Trips
@{
    ViewData["Title"] = "Поездки";
}

<div class="container">
    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6 col-12">
            <img class="w-100 img-fluid" src="/trips-bg.png" alt="">
        </div>
        <div class="col-md-3"></div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            @if (Model.ListOfTrips.Count > 0)
            {
                @foreach (var trip in Model.ListOfTrips)
                {
                    <div class="card w-100 my-3 mt-5 shadow">
                        <div class="card-body position-relative">
                            <div class="position-absolute" style="top: -35px; left: 0;">
                                <img src="@trip.Initiator.Avatar.Path" class="rounded mr-2" alt="аватарка" width="30" title="@trip.Initiator.Avatar.Name">
                                <strong>
                                    @if (!string.IsNullOrEmpty(trip.Initiator.FirstName) && !string.IsNullOrEmpty(trip.Initiator.LastName))
                                    {
                                        @($"{trip.Initiator.FirstName} {trip.Initiator.LastName}")
                                    }
                                    else
                                    {
                                        @trip.Initiator.Login
                                    }
                                </strong>
                            </div>
                            <h5 class="card-title d-flex justify-content-between">
                                @trip.Title
                                <small class="text-muted">
                                    @trip.Route[0]
                                    @if (trip.Route.Count > 1)
                                    {
                                        @($" - {trip.Route.Last()}")
                                    }
                                </small>
                            </h5>
                            <p class="card-text text-truncate text-wrap" style="max-height: 50px">@trip.Description</p>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">Участников: @trip.Users.Count</span>
                                <span class="text-muted">@trip.StartDate.ToString("D") - @trip.EndDate.ToString("D")</span>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <h4 class="text-center m-3">Таких поездок не существует.</h4>
            }
        </div>
        <div class="col-lg-2"></div>
        <div class="order-first order-lg-last col-lg-4">
            <div class="sticky-top">
                <div class="my-3 shadow p-3">
                    <h2>
                        Поиск
                    </h2>
                    <form method="get">
                        <div class="form-group">
                            <label asp-for="SearchOptions.Title">Название</label>
                            <input asp-for="SearchOptions.Title" class="form-control" type="text">
                            <span asp-validation-for="SearchOptions.Title" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="SearchOptions.DatesRaw">Даты</label>
                            <input asp-for="SearchOptions.DatesRaw" class="form-control" type="text" id="dateRangePicker">
                            <span asp-validation-for="SearchOptions.DatesRaw" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="SearchOptions.RouteRaw">Маршрут</label>
                            <input asp-for="SearchOptions.RouteRaw" class="form-control" type="text">
                            <small class="form-text text-muted">Введите населённые пункты через пробел.</small>
                            <span asp-validation-for="SearchOptions.RouteRaw" class="text-danger"></span>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input asp-for="SearchOptions.Archive" type="checkbox"> Поездка уже прошла
                            </label>
                        </div>
                        <input type="submit" class="btn btn-outline-dark mt-3" value="Искать">
                    </form>
                </div>
                <div class="my-3 text-center">
                    <a asp-area="" asp-page="AddTrip" class="btn btn-outline-primary">Добавить поездку</a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"/>
    <script src="js/trips.js"></script>
    <partial name="Shared/_ValidationScriptsPartial"/>
}