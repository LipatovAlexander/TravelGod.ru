@page "{id}"
@using TravelGod.ru.Models
@using TravelGod.ru.Infrastructure
@using System.ComponentModel.DataAnnotations
@model TravelGod.ru.Pages.TripPage
@{
    ViewData["Title"] = Model.Trip.Title;
}

<div class="jumbotron jumbotron-fluid">
    <div class="container">
    </div>
</div>

<main role="main" class="container">
    <div class="row">
        <div class="col-md-8 blog-main">
            <div class="blog-post overflow-hidden">
                <h2 class="blog-post-title">
                    @Model.Trip.Title<small> - @(Model.Trip.Type.GetAttribute<DisplayAttribute>().Name)</small>
                </h2>
                <p class="blog-post-meta">
                    @Model.Trip.StartDate.ToString("D") - @Model.Trip.EndDate.ToString("D")
                    @if (Model.Trip.EndDate < DateTime.Now)
                    {
                        <span class="text-info ml-2">Поездка уже прошла</span>
                    }
                </p>
                <p class="font-weight-bold">Маршрут:</p>
                <ul>
                    @foreach (var point in Model.Trip.Route)
                    {
                        <li>@point</li>
                    }
                </ul>
                <p>@Model.Trip.Description</p>
            </div><!-- /.blog-post -->
        </div><!-- /.blog-main -->

        <aside class="col-md-4 blog-sidebar">
            <div class="sticky-top">
                @if (Model.User is not null && !Model.Trip.Users.Contains(Model.User) && Model.Trip.EndDate > DateTime.Now)
                {
                    <div class="text-center mb-3">
                        <a asp-area="" asp-page="/TripPage" asp-page-handler="Join" class="btn btn-outline-primary mx-4">Присоединиться</a>
                    </div>
                }

                <div class="mb-3 p-4 shadow">
                    <h4 class="font-italic">Организатор</h4>
                    <div class="my-1">
                        <a asp-page="Profile" asp-route-id="@Model.Trip.Initiator.Id" class="text-dark text-nowrap">
                            <img src="/@Model.Trip.Initiator.Avatar.Path" class="rounded mr-2" alt="аватарка" width="30" title="@Model.Trip.Initiator.Avatar.Name">
                            <span>@Model.Trip.Initiator.DisplayName</span>
                        </a>
                    </div>
                    @if (!string.IsNullOrEmpty(@Model.Trip.Initiator.Description))
                    {
                        <p class="m-2">
                            О себе:
                            <span class="font-italic">
                                @(Model.Trip.Initiator.Description.Length > 25
                                    ? Model.Trip.Initiator.Description[..25] + "..."
                                    : Model.Trip.Initiator.Description)
                            </span>
                        </p>
                    }
                    <p class="m-2">Организовал поездок: <span class="font-italic">@Model.Trip.Initiator.OwnedTripsCount</span></p>
                    <p class="m-2">Принял участие: <span class="font-italic">@Model.Trip.Initiator.OwnedTripsCount</span></p>
                </div>
                <div class="mb-3 p-4 shadow">
                    <h4 class="font-italic">Участники <small> - @Model.Trip.UsersCount</small></h4>
                    <ol class="list-unstyled mb-0">
                        @foreach (var user in Model.Trip.Users)
                        {
                            <li>
                                <a asp-page="Profile" asp-route-id="@user.Id" class="text-dark text-nowrap">
                                    <img src="/@user.Avatar.Path" class="rounded mr-2" alt="аватарка" width="15" title="@user.Avatar.Name">
                                    <span>@user.DisplayName</span>
                                </a>
                            </li>
                        }
                    </ol>
                </div>
            </div>
        </aside><!-- /.blog-sidebar -->

    </div><!-- /.row -->

</main><!-- /.container -->